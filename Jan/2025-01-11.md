## 날짜: 2025-01-11

## 공부 내용 정리
### 쿠버네티스 오브젝트



<br>

## 쿠버네티스 Service
### 쿠버네티스 Service란? 
- pod 집합에 대한 네트워크 접근을 추상화한 리소스 
- pod가 네트워크 트래픽을 받을 수 있도록 서빙하는 역할을 함 
- pod가 생성 및 종료 되면서 IP 주소가 변경돼도 service는 고정된 접근 지점을 제공함 
- 따라서 pod는 IP 주소 변경과 상관 없이 동일한 DNS 이름과 IP를 유지함 
### Service의 특징 
- pod selector 기반 라우팅 : pod가 가진 label을 통해 어떤 pod로 트래픽을 보낼지 결정함
- 로드 밸런싱 : 내부 로드밸런서 역할 수행을 통해 여러 pod에 트래픽을 분산시킴 
- 고정 IP 제공 : service IP는 고정 IP이므로 안정적인 접속 경로를 제공함 
- DNS 통합 : 컨테이너 내부에서 service명을 통해 접근 가능 
### Service 유형
- ClusterIP : 기본 유형으로 클러스터 내부에서만 접근 가능한 IP 제공
- NodePort : 클러스터 외부에서 접근할 수 있도록 노드의 포트를 노출
- LoadBalancer : 클라우드 환경에서 외부 로드밸런서를 자동으로 생성
- ExternalName : 고정된 IP 대신 DNS 이름으로 외부 서비스를 가리킴


<br>

## CNI(Container Network Interface)
### CNI란?
- 컨테이너 및 쿠버네티스 기반 환경에서 네트워크를 표준화된 방식으로 구성 및 관리하기 위한 표준 인터페이스 
### 특징 
- 컨테이너 오케스트레이션 : 여러 컨테이너를 운영할 때 네트워크를 어떻게 할당할지 표준 및 호환성을 확보해줌
- 다양한 플러그인 제공 : Calico, Flannel, Weave Net 등이 대표적이며 네트워크 요구 사항에 따라 선택 가능 
- 설치와 교체가 비교적 간단함 : CNI 표준을 따르므로 다양한 플러그인 간 호환성이 높아 설정 변경이 비교적 쉬움 
### 동작 방식 
- kubelet이 pod 생성 요청을 감지
- kubelet은 CNI 플러그인에 네트워크 인터페이스 생성 요청을 보냄 
- CNI 플러그인은 요구사항에 따라 새로운 네트워크 인터페이스 생성 또는 연결
- pod는 생성된 인터페이스를 통해 네트워크에 연결됨 


<br>


## Calico
### Calico란? 
- 쿠버네티스에서 네트워킹 및 네트워크 보안을 제공하는 오픈소스 프로젝트 
- Layer3 라우팅 방식을 사용해 pod 간 통신을 단순하고 확장성 있게 처리함 
- eBPF 모드를 지원하여 커널 레벨에서 고성능 패킷 처리가 가능하며 네트워크 정책을 유연하게 제어 가능 
  - eBPF : 리눅스 커널에서 사용자 정의 프로그램을 안전하게 실행할 수 있도록 해주는 기술로 높은 성능, 네트워크 패킷 처리, 시스템 모니터링, 보안 등의 
  기능을 구현함
### 구성 요소 
- Felix : 각 노드에서 동작하는 Calico의 핵심 에이전트로 라우팅 테이블 및 보안 정책 설정 담당 
- Typha : 대규모 클러스터의 스케일 업을 위해 etcd와 Felix 간의 연결을 효율화하는 컴포넌트 
- BGP : 노드 간 라우팅 정보를 교환하여 pod간 통신을 L3 라우팅 방식으로 처리함
### 동작 방식 
- Kube API Server / etcd : 쿠버네티스 상태(Pod, CRD, NetworkPolicy 등)를 저장 및 관리
- Felix : 각 노드에서 동작하며 네트워크 라우팅 및 정책 설정을 실시간으로 반영
- BGP : 내부적으로 BGP 세션을 맺어 노드 간 라우팅 정보를 교환


<br>

## Ingress 
### Ingress란? 
- 클러스터 외부에서 내부의 여러 서비스로 라우팅되는 트래픽을 제어하는 리소스 
- Ingress 리소스는 Ingress 컨트롤러와 함께 작동하며 실제 트레픽 라우팅을 담당함   
### 특징 
- 도메인 기반 라우팅 : 하나의 IP 주소로 여러 도메인을 호스팅하고 각각의 도메인에 대해 다른 서비스로 라우팅 가능 
- path 기반 라우팅 : 라우팅 path에 따라 트래픽 분산 가능 
- TLS/SSL 지원 : HTTPS 트래픽을 처리할 수 있도록 TLS 인증서를 적용 가능 
- L7 라우팅 : HTTP/HTTPS 요청에서의 Host Header, path등 정보를 기반으로 세밀한 라우팅이 가능
### 대표적인 Ingress Controller
- Nginx Ingress Controller : 가장 많이 사용되며 커스터마이징이 용이
- Traefik : 간편한 설정과 다양한 프로토콜 지원
- HAProxy : 고성능 요구사항에 적합

<br>

## L4 vs L7
- Calico NetworkPolicy는 IP, port(L3/L4) 기반의 정책에 초점을 맞춤 
- Ingress는 도메인/URL path/host header(L7) 등을 기준으로 트래픽을 분기함 



<br>

## Job, Cron Job 
### Job
- 지정된 작업이 완료될 때까지 pod를 실행하도록 보장하는 컨트롤러 
#### Job의 특징 
- 일회성 task : 특정 작업을 한 번 수행하고 끝나는 애플리케이션 
- 완료 보장 : 지정된 작업이 성공적으로 실행을 끝낼 때까지 pod를 재시도
- pod 개수 제어 : 동시에 여러 pod를 실행 가능
#### Job의 동작 원리 
- Job 컨트롤러가 관리하는 pod들은 종료 시점까지 실행
- 작업이 실패하면 Job 컨트롤러가 pod를 재시작 또는 새로운 pod를 생성해 작업을 반드시 완료함 
- 정해진 성공 횟수 또는 특정 성공 조건에 도달 시 Job은 종료
### Cron Job
- 지정된 스케줄에 맞춰 Job을 반복 실행할 수 있게 하는 컨트롤러 
#### Cron Job의 특징
- 반복 스케줄 : Cron 표현식을 기반으로 주기적으로 Job을 실행
- 표준 Cron 문법 사용 : 작업 스케줄을 쉽게 정의 가능(`*/5 * * * *`)  
- Job과 동일한 실행 보장 

<br>




### 오늘의 회고
- 오늘은 어제 못다한 쿠버네티스 네트워크 파트의 정리를 마무리했다. 네트워크 CS의 전반적인 이해가 기반이 돼야 학습하는 데 무리가 없는 부분이라 
용어 정리 및 동작 원리 등을 이해하는 데 시간이 많이 소요됐다. 여러 번 반복해서 읽고 모르는 단어를 찾아보며 공부하니 처음 학습했을 때 보단 이해가 
수월했던 것 같다.



<br>