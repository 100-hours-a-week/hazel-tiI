## 날짜: 2024-11-26

## 오늘의 과제 : 커뮤니티 댓글 개수, 좋아요 수 수정하기 

<br>

### 1. 문제 : 댓글 작성/삭제 시 댓글 개수 업데이트가 제대로 이뤄지지 않음 
1. json 파일에서 파싱한 댓글 수의 증가/감소가 동작하지 않음 
2. 댓글 증가/감소/업데이트 로직이 분리되어 있지 않음 
3. 댓글 작성 후 새로고침을 해야만 댓글 수가 업데이트 됨 


<br>


### 2. 문제 : 좋아요 클릭 시 무한정 증가하는 문제 
1. 좋아요 클릭 시 무한정 증가하는 문제 
2. API 500 오류 
3. 좋아요 카운트 음수 문제 


<br>

### 1-1. json 파일에서 파싱한 댓글수의 증가/감소가 이뤄지지 않는 문제 
#### 문제 원인
> `GET` 요청을 통해 댓글 수를 단순히 받아오기만 하고 댓글 작성/삭제 시 댓글 수를 증가/감소시키는 로직을 처리하지 않음 
#### 해결 방법 
- `POST` 요청 추가: 댓글 작성/삭제 시 댓글 수를 증감하도록 `POST` 요청을 추가하고 요청의 `action` 값(add 또는 delete)에 따라 댓글 수를 변경

<br>


### 1-2. 댓글 증가/감소/업데이트 로직이 분리되지 않은 문제
#### 문제 원인
> 댓글 수를 관리하는 로직이 하나의 함수로 통합되어 있고 댓글 수 조회 및 업데이트가 동일한 API 경로에서 처리되어 발생
#### 해결 방법
- `fetch` 요청 함수 분리 
    - 댓글 수를 조회하는 함수`getCommentCount`와 댓글 수를 업데이트하는 함수`updateCommentCount`로 분리
    - 댓글 수 조회 `getCommentCount` : 게시글이 처음 로드될 때 서버에서 댓글 수를 가져와 `DOM`에 반영 
    - 댓글 수 업데이트 `updateCommentCount` : 댓글 작성 시 `action: 'add'`, 댓글 삭제 시 `action: 'delete'`를 `body`에 전달해서 댓글 수를 서버에서 수정함 

<br>


### 1-3. 댓글 작성 후 새로고침을 해야 댓글 수가 업데이트 되는 문제 
#### 문제 원인 
> 댓글 작성 후 서버와 동기화를 기다리는 동안 클라이언트 UI가 즉시 업데이트 되지 않음 -> 댓글 수 업데이트가 서버 응답에 의존하여 UI 반영이 지연됨 
#### 해결 방법
- 댓글 작성 시 DOM에서 댓글 수를 즉시 증가시키는 로직을 추가함 
- 서버-클라이언트 간의 데이터 불일치를 막기 위해 서버에서 반환된 commentCount를 DOM에서 반영 


<br>

### 2-1. 좋아요 클릭 시 좋아요 수 무한정 증가하는 문제 
#### 문제 원인 
> 게시글 아이디 및 사용자 아이디에 따른 확인/제한 로직이 없어 동일한 사용자가 반복적으로 좋아요 누르는 행위를 허용
#### 해결 방법
- 컨트롤러에 유저가 좋아요를 눌렀는지 확인하는 로직 추가 
    - 사용자가 이미 좋아요를 누른 경우 : 좋아요 취소 처리 
    - 사용자가 좋아요를 누르지 않은 경우 : 좋아요 수 추가 처리 



<br>

### 2-2. API 500 오류
#### 문제 원인 
> 게시글 생성 시 `like` 필드가 정의 되지 않아 기본 값이 없었고 게시글의 `likes` 배열이 초기화 되지 않아 접근 시 에러 발생
#### 해결 방법
- `likePost` 함수에서 `post.likes`가 정의되지 않은 경우 빈 배열로 초기화 
- `makePost` 함수에서 게시글 생성 시 `like: 0`, `likes: []` 필드 추가  


<br>

### 2-3. 좋아요 카운트 음수 방지
#### 개선 
- 좋아요 수가 감소할 때 `Math.max(0, post.like - 1)`를 사용해 최소값을 `0`으로 설정하고 음수를 방지함 



<br>


### 오늘의 회고 
- 댓글 수 업데이트 문제를 해결하며 RESTful 설계와 서버-클라이언트 간 역할 분리에 대해 다시 한 번 깊이 고민하는 시간을 가졌다. 처음에는 간단히 해결될 줄 알고 충분한 설계 없이 바로 코드를 작성했지만 여러 곳에서 문제가 발생하며 예상보다 시간이 더 걸렸다. 이번 경험을 통해 코드가 길고 복잡해질수록 간단한 기능을 추가하더라도 로직에 대한 명확한 설계가 선행돼야 함을 다시금 깨달았다. 기능 구현 전에 전체적인 흐름과 구조를 미리 정리하고 시작하는 습관이 더욱 중요하다는 것을 느꼈다.

- 다행히 이전에 겪었던 문제들을 정리하고 기록해 둔 덕분에 문제 해결에 드는 시간을 줄일 수 있었다. 앞으로도 문제와 오류를 체계적으로 정리하고 이를 기반으로 더 나은 코드를 작성하는 습관을 유지해야겠다는 생각이 들었다. 



<br>