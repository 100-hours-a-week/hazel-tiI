
## 날짜: 2024-12-17

## 커뮤니티 과제 : 오류 수정 

### 1. 회원가입 : 프로필 이미지 저장 경로 및 폴더 분기 조건 문제 
#### 문제 정리 
- `multer`를 `middleware`로 분리하면서 경로 지정 문제가 발생하였음 
  - 오류 경로 : `/middlewares/uploads/...` → 잘못된 중첩 경로
  - 실제 경로 : `/uploads/profiles` 또는 `/uploads/posts`
- 폴더를 프로필 이미지인지 게시글 콘텐츠 이미지인지에 따라 나눠야 하는데 분기 조건의 문제가 있었음
  - `req.originalUrl.includes('/profile')`를 검사했지만 URL 경로와 조건이 일치하지 않음
  - 회원가입 시 `/signup`에서 잘못된 경로 `uploads/posts`로 잘못 이동됨 
#### 경로 문제 
- `rootDir` 변수를 사용해 프로젝트의 루트 경로를 가리키도록 수정
- `const rootDir = path.resolve(__dirname, '..');`
#### 폴더 분기 조건 문제
- `req.originalUrl`의 조건 수정
- `URL`에 `/signup` 또는 `/profile`이 포함되면 `uploads/profiles` 로 파일을 저장하도록 설정

<br>

---

<br>

### 2. 회원 정보 수정 : 프로필 이미지 로드 실패 
#### 문제 정리 
- 프로필 이미지 경로가 중복되고 `req.file`이 `undefined`인 상태에서 접근해서 오류 발생
#### 해결 방법 
1. `editProfile` 컨트롤러 : `req.file`이 `undefined`인지 확인 후 `filename`에 접근하도록 조건문 추가
2. `getCurrentUser` 컨트롤러 : 프로필 이미지 경로 중복 제거
3. 프론트엔드 : 프로필 이미지 `URL` 중복 방지를 위해 상대 경로 처리 시 서버 `URL`을 조건부로 추가


<br>

---

<br>


### 3. 게시글 생성 : 게시글 user_id가 null로 반환
#### 문제 정리
- 게시글 생성 시 `userId`를 `req.body`에서 가져오는데 정상적으로 전달되지 않아 `undefined`로 처리됨
- 결과적으로 게시글 작성자의 `user_id`, 닉네임, 프로필 이미지 값이 `null`로 저장됨
#### 해결 방법
- `userId`를 로그인 세션에서 가져오도록 수정
- `const userId = req.session?.user?.userId;`

<br>

---

<br>


### 4. 게시글 목록 : 게시글 사용자 정보 렌더링 문제
#### 문제 정리
- `DB` 조회 시 사용자 정보가 누락되거나 `undefined`가 반환되면서 프론트에서 오류 발생
- 사용자 닉네임과 프로필 이미지가 비어 있을 경우 게시글 렌더링에서 타입 에러 발생
#### 해결 방법
- DB 조회 시 기본값 처리를 통해 `null`이 반환될 경우 빈 문자열 또는 기본값을 반환하도록 설정
- 프론트에서 사용자 정보를 `return` 할 때 사용자 정보가 누락된 경우에도 기존 게시글 데이터를 유지하고 렌더링


<br>

---

<br>


### 오늘의 회고 
- Json 기반 데이터에서 DB로 리팩토링을 진행하면서 발생한 키 매핑 불일치와 데이터 흐름 문제를 해결했다. 리팩토링을 진행하면서 프론트엔드와 백엔드 데이터 
간의 데이터 구조가 달라져 호환성 문제가 빈번하게 발생하였다. 
- 오늘 경험을 통해 백엔드와 프론트엔드에서 데이터를 주고 받을 때 정확한 데이터 스키마와 키 네이밍 규칙이 필요함을 다시 한 번 깨달았다. 
- 오류를 해결할 때 콘솔 로그를 통해 오류를 해결하다 보니 개발 시간이 많이 지연 되었는데 앞으로는 개발자 도구를 활용한 디버깅 습관을 기르도록 해야겠다. 



<br>